<!-- Add this script to handle AJAX polling -->
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const taskId = urlParams.get('task_id');

    if(taskId) {
        function checkTaskStatus() {
            fetch(`/task_status/${taskId}`)
                .then(response => response.json())
                .then(data => {
                    if(data.state === 'SUCCESS') {
                        // Display the results
                        document.querySelector('.flashes').innerHTML += `<li class="success">PDF processing completed successfully.</li>`;
                        // Optionally, update the page with translation and summary
                        location.reload();  // Reload to fetch results
                    } else if(data.state === 'FAILURE') {
                        document.querySelector('.flashes').innerHTML += `<li class="error">An error occurred during processing.</li>`;
                    } else {
                        // Still processing
                        console.log(`Task status: ${data.state}`);
                    }
                })
                .catch(error => {
                    console.error('Error fetching task status:', error);
                });
        }

        // Poll every 5 seconds
        setInterval(checkTaskStatus, 5000);
    }
</script>
